{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>MediVault Login</title>
  <link rel="stylesheet" href="{% static 'css/style.css' %}">
</head>
<body>
  <div class="page-container">
    <h1 class="title">ğŸ›¡ï¸ MediVault</h1>
    <p class="subtitle">Your secure gateway to managing health records with confidence.</p>

    <div class="form-wrapper">
      <h2 class="form-title">Login</h2>

      <form method="POST">
        {% csrf_token %}

        <label for="aadhaar_number">ğŸ” Enter Your Aadhaar Number:</label>
        <input type="number" name="aadhaar_number" id="aadhaar_number" maxlength="12" value="{{ aadhaar_number }}"
               pattern="\d{12}" placeholder="12-digit Aadhaar Number" required>

        <div class="button-center">
          <button type="submit" name="action" value="send_otp">Send OTP</button>
        </div>

        <div class="register-prompt">
          <p>Havenâ€™t registered?
            <a href="{% url 'register' %}">Register</a>
          </p>
        </div>


        {% if show_otp_field %}
          <label for="otp">Enter OTP:</label>
          <input type="number" name="otp" id="otpInput" maxlength="6" placeholder="Enter OTP">

          <p id="timer"></p>

          <div class="button-center">
            <button type="submit" name="action" value="verify_otp" id="verifyBtn">Verify OTP</button>
          </div>

          {% if resend_otp %}
            <div class="button-center">
              <button type="submit" name="action" value="resend_otp" id="resendBtn">Resend OTP</button>
            </div>
          {% else %}
            <div class="button-center">
              <button type="submit" name="action" value="resend_otp" id="resendBtn" style="display: none;">Resend OTP</button>
            </div>
          {% endif %}

          {% if otp_sent %}
            <script>
              const timerDisplay = document.getElementById("timer");
              const verifyBtn = document.getElementById("verifyBtn");
              const resendBtn = document.getElementById("resendBtn");

              let duration = 60;
              const countdown = setInterval(() => {
                const minutes = Math.floor(duration / 60);
                const seconds = duration % 60;
                timerDisplay.textContent = `Time left: ${minutes}:${seconds < 10 ? '0' : ''}${seconds}`;

                if (duration <= 0) {
                  clearInterval(countdown);
                  timerDisplay.textContent = "OTP expired. Please request a new one.";
                  verifyBtn.disabled = true;
                  verifyBtn.style.backgroundColor = "#ccc";
                  resendBtn.style.display = "inline-block";
                }

                duration--;
              }, 1000);
            </script>
          {% endif %}
        {% endif %}
      </form>

      {% for message in messages %}
        <p class="{{ message.tags }}">{{ message }}</p>
      {% endfor %}
    </div>
  </div>
</body>
</html>